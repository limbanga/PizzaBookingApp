@page "/login"
@using PizzaBookingViewModel;
@inject IAuthService _AuthService
@inject NavigationManager _NavigationManager
@layout EmptyLayout

<div class="container">
	<div class="row">
		<div class="offset-4 col-4 card p-3 mt-5">
			<h3 class="text-center">Login</h3>
			<EditForm Model="loginViewModel" OnSubmit="HandleLogin">
				<DataAnnotationsValidator />

				<div class="form-floating mt-3 w-100">
					<InputText type="text" class="form-control" placeholder=" " @bind-Value="loginViewModel.LoginName" />
					<label for="">Email</label>
					<ValidationMessage For="@(() => loginViewModel.LoginName)" />
				</div>

				<div class="form-floating mt-3 w-100">
					<InputText type="password" class="form-control" placeholder=" " @bind-Value="loginViewModel.Password" />
					<label for="">Password</label>
					<ValidationMessage For="@(() => loginViewModel.Password)" />
				</div>

				<div class="text-end mt-3">
					<button class="btn btn-success" type="submit">Login</button>
				</div>
			</EditForm>
		</div>
	</div>
</div>

@code {
	LoginViewModel loginViewModel = new LoginViewModel();

	private async void HandleLogin()
	{
		Console.WriteLine("HandleLogins");
		var respone = await _AuthService.LoginAsync(loginViewModel);

		if (respone is null || string.IsNullOrEmpty(respone.AccessToken))
		{
			Console.WriteLine("Login failed!");
			return;
		}

		Console.WriteLine("Login success");
		_NavigationManager.NavigateTo("/admin/index");
	}
}
